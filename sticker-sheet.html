<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="Permissions-Policy" content="gamepad=(self), clipboard-read=(self)">

    <title>Sticker Sheet Creator</title>
    <!-- External Libs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- GIF Encoder -->
    <script src="lib/gif.js"></script>
    
    <!-- Fonts for Stamps (Google Fonts) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Pacifico&family=Permanent+Marker&family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="sticker-sheet.css">
</head>
<body data-theme="video-rental">

<div class="emoji-wallpaper" id="emojiWallpaper"></div>
<div id="gp-indicator" class="gamepad-mode-indicator"><span class="icon">üéÆ</span><span id="gp-mode-text">Menu Mode</span></div>
<div id="toast" class="toast-notification">Notification Message</div>
<div id="loading-overlay"><div class="spinner"></div><p>Processing...</p></div>

<!-- HELP MODAL -->
<div id="help-modal" class="modal-overlay" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="help-modal-title">
        <button class="modal-close" id="helpModalCloseBtn" aria-label="Close help dialog">√ó</button>
        <h2 id="help-modal-title" style="margin-top:0;">User Guide</h2>
        <div class="guide-section">
            <h3>Layouts</h3>
            <ul>
                <li><strong>1 Photo (1x16):</strong> Repeats 1 image 16 times.</li>
                <li><strong>4 Photos (2x2 Grid):</strong> Fills 4 quadrants.</li>
                <li><strong>16 Unique Photos:</strong> Individual control for every sticker.</li>
            </ul>
        </div>
        <div class="guide-section">
            <h3>Editing</h3>
            <p><strong>Double-click</strong> any sticker to reset its zoom and position.</p>
            <p><strong>Tap the üîç button</strong> to open fullscreen editing mode (great for mobile!).</p>
        </div>
        <div class="guide-section">
            <h3>Cutting Template</h3>
            <p>The "Download Cutting Template (SVG)" button generates a vector file compatible with cutting plotters such as the <strong>Cricut¬Æ</strong> or <strong>Silhouette‚Ñ¢</strong>. This file contains the cut lines for the stickers.</p>
        </div>
        <div class="guide-section">
            <h3>Paste Images</h3>
            <p>Press <strong>Ctrl+V</strong> (or <strong>Cmd+V</strong>) anywhere to paste images from your clipboard.</p>
        </div>
    </div>
</div>

<!-- FULLSCREEN CROP MODAL -->
<div id="fullscreen-crop-modal" class="fullscreen-crop-modal">
    <div class="fullscreen-crop-header">
        <h3>‚úÇÔ∏è Crop Sticker</h3>
        <button class="fullscreen-crop-close" id="fullscreenCropCloseBtn" aria-label="Close crop editor">√ó</button>
    </div>
    <div class="fullscreen-crop-body">
        <div class="fullscreen-crop-container" id="fullscreen-crop-container">
            <img id="fullscreen-crop-image" src="" alt="Crop">
        </div>
    </div>
    <div class="fullscreen-crop-controls">
        <button class="fullscreen-crop-btn" id="fullscreenCropZoomOutBtn" type="button">
            <span style="font-size:1.5rem;">‚àí</span> Zoom Out
        </button>
        <div class="zoom-display" id="fullscreen-zoom-display">100%</div>
        <button class="fullscreen-crop-btn" id="fullscreenCropZoomInBtn" type="button">
            <span style="font-size:1.5rem;">+</span> Zoom In
        </button>
        <button class="fullscreen-crop-btn" id="fullscreenCropResetBtn" type="button">
            ‚Üª Reset
        </button>
        <button class="fullscreen-crop-btn" id="fullscreenCropDoneBtn" style="background: var(--green-btn); border-color: var(--green-btn);" type="button">
            ‚úì Done
        </button>
    </div>
</div>

<div class="controls">
    
    <!-- 1. Top Settings -->
    <div class="control-section">
        <div class="settings-row">
            <div class="setting-group">
                <label>Theme:</label>
                <select id="theme-select">
                    <optgroup label="Color Themes">
                        <option value="video-rental" selected>Video Rental</option>
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                        <option value="retro">Retro</option>
                        <option value="1-up" hidden disabled id="theme-1up-option">üçÑ 1-UP</option>
                    </optgroup>
                    <optgroup label="Wallpaper Themes">
                        <option value="hearts">Hearts & Bubbles üíñ</option>
                        <option value="vines">Vines & Flowers üåø</option>
                    </optgroup>
                </select>
            </div>
            <div class="setting-group">
                <label>Background Pattern:</label>
                 <select id="bg-select">
                    <option value="none">None (White)</option>
                    <option value="hearts">Hearts</option>
                    <option value="stripes">Stripes</option>
                    <option value="flowers">Flowers</option>
                    <option value="custom">Custom...</option>
                </select>
                <input type="file" id="custom-bg-input" accept="image/*" style="display:none" aria-label="Upload custom background">
            </div>
            <div class="setting-group">
                <label>Paper Size:</label>
                <select id="paper-size">
                    <option value="4x6">4" x 6" (Recommended)</option>
                    <option value="hagaki">100mm x 148mm (Official)</option>
                    <option value="letter">8.5" x 11" (Letter)</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- 2. Project Buttons -->
    <div class="control-section">
        <div class="project-buttons">
            <button class="btn-project" id="saveProjectBtn" type="button">
                <span class="emoji-icon">üíæ</span> Save Project
            </button>
            <button class="btn-project" id="loadProjectBtn" type="button">
                <span class="emoji-icon">üìÇ</span> Load Project
            </button>
            <input type="file" id="load-project-input" accept=".json" style="display:none">
        </div>
    </div>
    
    <!-- 3. Layout, Upload, Actions -->
    <div class="control-section">
        <div class="mode-selector">
            <button id="btn-single" data-mode="single" type="button">1 Photo (1x16)</button>
            <button id="btn-quad" data-mode="quad" type="button">4 Photos (2x2 Grid)</button>
            <button id="btn-unique" data-mode="unique" type="button">16 Unique Photos</button>
        </div>
        
        <!-- The Upload Grid -->
        <div class="upload-area" id="upload-inputs" data-mode="quad"></div>

        <div class="action-bar">
            <!-- Left -->
            <button class="help-btn" id="actionHelpBtn" title="Open Guide" aria-label="Open guide">?</button>
            
            <!-- Center Toggles -->
            <div class="toggles">
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-overlay">
                    Show Kiss Cut
                </label>

                <label class="toggle-label" title="Simulates faded, old ink">
                    <input type="checkbox" id="toggle-weathered">
                    Fade
                </label>
                
                <label class="toggle-label" title="Simulates CRT scanlines">
                    <input type="checkbox" id="toggle-crt">
                    CRT Effect
                </label>
            </div>
            
            <!-- Right Actions -->
            <div class="actions-right">
                <input type="file" id="bulk-input" multiple accept="image/png, image/jpeg, image/gif, image/webp, video/webm" style="display:none">
                
                <button class="btn-purple" id="importSnapsBtn" type="button">
                    <span class="emoji-icon">üì∑</span> Import Snaps
                </button>

                <button class="btn-purple" id="bulkUploadBtn" type="button">
                    <span class="emoji-icon">üì§</span> Upload
                </button>

                <button class="btn-purple" id="printBtn" type="button" title="Print the sticker sheet directly">
                    <span class="emoji-icon">üñ®Ô∏è</span> Print
                </button>

                <div class="save-group">
                    <select id="export-format">
                        <option value="png">PNG</option>
                        <option value="jpg">JPG</option>
                        <option value="pdf">PDF</option>
                        <option value="gif">GIF</option>
                    </select>
                    <div class="save-separator"></div>
                    <button class="btn-green" id="saveOutputBtn" type="button">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="paper">
    <div id="background-layer"></div>
    <div id="sticker-grid"></div>
    <div id="dither-overlay"></div>
    <div id="crt-overlay"></div>
    <div id="stamp-layer"></div>
</div>

<button class="btn-project" id="cuttingTemplateBtn" type="button" style="display:block; width:100%; max-width:800px; margin:20px auto; justify-content:center; background: var(--light-blue); color: var(--text);">
    Download Cutting Template (SVG)
</button>

<div class="stamp-selector">
    <label>Add Stamp:</label>
    <div class="stamp-list" id="stamp-list-container">
        <!-- Stamps generated dynamically via JavaScript -->
        <input type="text" placeholder="Type or paste emoji" class="custom-stamp-input" id="custom-emoji-input" aria-label="Custom emoji input">
        <button class="btn-stamp-add" id="customEmojiAddBtn" type="button" title="Add custom emoji" aria-label="Add custom emoji" style="background: var(--accent); color: var(--bg); font-weight: bold;">+</button>
    </div>
    
    <div class="text-stamp-controls">
        <input type="text" id="text-stamp-input" placeholder="Type text..." class="text-input">
        <select id="text-font-select" style="flex:1;">
            <option value="'Press Start 2P', cursive">8-Bit</option>
            <option value="'Bangers', cursive">Comic</option>
            <option value="'Permanent Marker', cursive">Marker</option>
            <option value="'VT323', monospace">Terminal</option>
            <option value="'Pacifico', cursive">Script</option>
        </select>
        <input type="color" id="text-color-input" value="#000000" class="color-input">
        <button class="btn-green" id="addTextStampBtn" type="button" style="border-radius:6px; color:white;">Add</button>
    </div>
</div>


<script src="sticker-sheet.js" defer></script>
</body>
</html>
