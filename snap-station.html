<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Permissions-Policy" content="gamepad=(self); camera=(self); microphone=()">
    <title>Snap Station</title>
    <!-- Removed Google Fonts for Utilitarian System Look -->
    <link rel="stylesheet" href="snap-station.css">
</head>
<body data-theme="video-rental">
    <div class="emoji-wallpaper" id="emojiWallpaper"></div>
    
    <!-- Main Snap Station View -->
    <div class="container" id="mainApp">
        <header>
            <h1>ğŸ“· Snap Station</h1>
        </header>

        <div class="monitor-frame">
            <div class="siren-container" id="sirenContainer" title="Click to toggle flashing" aria-label="Toggle siren" role="button" tabindex="0">
                <span class="siren" id="siren">ğŸš¨</span>
            </div>
            
            <div class="video-container" id="videoContainer" title="Scroll to zoom, drag to pan, double click to reset">
                <video id="webcam" autoplay playsinline webkit-playsinline muted></video>
                <div class="crt-overlay" id="crtOverlay"></div>
                <div class="flash-overlay" id="flashOverlay"></div>
                <div class="video-overlay">
                    <div class="recording-indicator" id="recordingIndicator">
                        <span class="dot"></span> <span>REC</span>
                    </div>
                    <div class="timer-display" id="timerDisplay">5</div>
                </div>
                <div class="no-camera" id="noCamera">
                    <div class="no-camera-icon">ğŸ“·</div>
                    <p id="noCameraMessage">Camera access required</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">Click "Start Camera" below</p>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="startCameraBtn"><span class="btn-icon">ğŸ“·</span>Start Camera</button>
                <button class="btn" id="shareScreenBtn"><span class="btn-icon">ğŸ–¥ï¸</span>Share Screen</button>
                <div class="ratio-toggle" id="ratioToggle">
                    <button class="ratio-option active" data-ratio="16:9">16:9</button>
                    <button class="ratio-option" data-ratio="4:3">4:3</button>
                </div>
                <button class="btn" id="fullscreenBtn" title="Toggle fullscreen"><span class="btn-icon" id="fullscreenIcon">â›¶</span>Fullscreen</button>
                <button class="btn btn-primary" id="screenshotBtn" disabled><span class="btn-icon">ğŸ“¸</span>Take Picture</button>
                <button class="btn btn-primary" id="gifBtn" disabled><span class="btn-icon">ğŸ¬</span>Record GIF</button>
                <button class="btn" id="saveProfileBtn" title="Save current settings and snaps"><span class="btn-icon">ğŸ’¾</span> Save Profile</button>
                <button class="btn" id="loadProfileBtn" title="Load a saved profile"><span class="btn-icon">ğŸ“‚</span> Load Profile</button>
                <input type="file" id="profileInput" style="display: none;" accept=".json">
            </div>
            
            <div class="fx-controls">
                <div class="tooltip-container">
                    <div class="help-btn" id="helpBtn" tabindex="0" role="button" aria-label="Open station guide">?</div>
                    <div class="tooltip-content" id="helpTooltip">
                        <div class="tooltip-header">STATION GUIDE</div>
                        <ul class="tooltip-list">
                            <li><span class="tooltip-icon">ğŸ–±ï¸</span><span><b>Zoom/Pan:</b> Scroll to zoom, Drag to move.</span></li>
                            <li><span class="tooltip-icon">ğŸ“¸</span><span><b>Snap:</b> Click to Select. Use toolbar to act.</span></li>
                            <li><span class="tooltip-icon">ğŸ¬</span><span><b>GIF:</b> Records 5s loop.</span></li>
                            <li><span class="tooltip-icon">ğŸ®</span><span><b>Gamepad:</b> L1+L2+R1+R2 to Toggle Mode.</span></li>
                        </ul>
                    </div>
                </div>

                <button class="btn btn-sm btn-toggle" id="muteToggle">ğŸ”Š Sound On</button>
                <button class="btn btn-sm btn-toggle" id="crtToggle">ğŸ“º CRT Mode</button>
                <button class="btn btn-sm btn-toggle" id="mirrorToggle">Mirror Video</button>
                
                <div style="display: flex; align-items: center;">
                    <label for="themeSelect" class="controls-label">ğŸ¨ Theme:</label>
                    <select id="themeSelect" class="controls-select">
                        <optgroup label="Color Themes" id="colorThemesGroup">
                            <option value="video-rental" selected>Video Rental</option>
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                            <option value="retro">Retro</option>
                        </optgroup>
                        <optgroup label="Wallpaper Themes">
                            <option value="hearts">Hearts & Bubbles ğŸ’–</option>
                            <option value="vines">Vines & Flowers ğŸŒ¿</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <div class="status-bar" id="statusBar"></div>

            <div class="gallery-container">
                <div class="gallery-header">
                    <h3 class="gallery-title">Recent Snaps</h3>
                    <span class="gallery-counter" id="galleryCounter">0 / 256</span>
                </div>
                <div class="gallery-actions">
                    <button class="btn btn-sm" id="selectAllBtn">âœ… Select All</button>
                    <button class="btn btn-sm" id="sendToStickerBtn">ğŸ“· Send to Stickers</button>
                    <button class="btn btn-sm" id="downloadBtn">â¬‡ï¸ Download</button>
                    <button class="btn btn-sm" id="deleteBtn">ğŸ—‘ï¸ Delete</button>
                </div>
                <div class="gallery" id="gallery">
                    <div class="empty-gallery" id="emptyGallery">No snaps yet! Take a picture or video.</div>
                </div>
            </div>
        </div>

        <div class="gamepad-indicator" id="gamepadIndicator">
            <span class="mode-icon" id="gamepadModeIcon">ğŸ®</span>
            <span id="gamepadModeText">Menu Mode</span>
        </div>

        <div class="undo-toast" id="undoToast">
            <span id="toastMessage">Action Completed</span>
        </div>
    </div>

    <canvas id="captureCanvas"></canvas>
    <script src="lib/gif.js"></script>
    <script src="snap-station.js" defer></script>
</body>
</html>
